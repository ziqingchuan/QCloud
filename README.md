# 文件管理系统 (QCloud)

一个类似百度云盘的文件管理系统，支持文件展示、预览、搜索、下载等功能。纯前端实现，无需后端。

## 功能特性

- 自动读取 `public/files` 文件夹中的所有文件和子文件夹
- **支持文件夹嵌套**：递归读取子文件夹，支持展开/折叠
- **三种视图模式**：列表视图、网格视图、分栏视图（类似GitHub）
- 文件搜索功能
- 双击文件预览内容（弹出层显示）
- 支持文本文件预览（TXT、MD、HTML、CSS、JS、JSON、CSV等）
- 支持图片文件预览（JPG、PNG、GIF、SVG、WEBP等）
- 支持PDF文件预览（浏览器内置查看器）
- 文本文件一键复制到剪贴板
- 单个文件下载
- 批量文件下载
- 响应式设计，支持移动端
- 专业的B端后台风格界面
- 优雅的顶部Toast提示
- 支持多种文件类型识别
- 智能版本控制，确保文件列表实时更新

## 技术栈

- React 19
- Vite
- CSS3

## 视图模式

### 1. 列表视图（默认）
- 显示详细信息：名称、大小、修改日期、操作
- 支持文件选择和批量下载
- 支持文件夹展开/折叠
- 子文件夹缩进显示
- 适合管理大量文件

### 2. 网格视图
- 卡片式展示
- 大图标显示
- 适合浏览图片和文档

### 3. 分栏视图（类似GitHub）
- 左侧：文件列表（支持文件夹展开/折叠）
- 右侧：文件预览
- 点击文件即可在右侧查看内容
- 适合快速浏览和查看文件内容
- 支持文本、图片、PDF预览
- 支持一键复制文本内容

## 文件夹功能

### 展开/折叠
- 点击文件夹名称或左侧箭头图标展开/折叠
- 展开时显示向下箭头 ▼
- 折叠时显示向右箭头 ▶
- 子文件夹支持多层嵌套

### 缩进显示
- 子文件夹和文件会根据层级自动缩进
- 每层缩进24px（列表视图）或20px（分栏视图）
- 清晰显示文件层级关系

## 开始使用

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

系统会自动扫描 `public/files` 目录（包括子文件夹）并生成文件列表，然后启动开发服务器。

访问 http://localhost:5173

### 构建生产版本

```bash
npm run build
```

构建前会自动生成文件列表，打包后的文件在 `dist` 目录。

## 文件管理

将需要展示的文件放置在 `public/files` 目录下，支持子文件夹嵌套。

### 目录结构示例

```
public/files/
├── 文档/
│   ├── 说明.md
│   └── 教程.pdf
├── 图片/
│   ├── 截图1.png
│   └── 截图2.png
├── 代码/
│   ├── 前端/
│   │   └── app.js
│   └── 后端/
│       └── server.js
└── README.txt
```

### 支持预览的文件类型

**PDF文件：**
- PDF（浏览器内置查看器）

**文本文件：**
- TXT, MD, HTML, CSS, JS, JSX, TS, TSX
- JSON, XML, CSV, LOG
- DOC, DOCX（作为文本预览）

**图片文件：**
- JPG, JPEG, PNG, GIF, SVG, WEBP, BMP

**其他文件：**
- ZIP, RAR, 7Z等压缩包
- 不支持预览，但可以下载

## 项目结构

```
├── public/
│   ├── files/              # 存放文件的目录（支持子文件夹）
│   └── api/                # 自动生成的文件列表
│       └── files.json      # 文件元数据（包含文件夹结构）
├── src/
│   ├── components/         # 组件目录
│   │   ├── FileList.jsx   # 文件列表组件
│   │   ├── FileItem.jsx   # 文件项组件
│   │   ├── SplitView.jsx  # 分栏视图组件
│   │   ├── Toolbar.jsx    # 工具栏组件
│   │   ├── FileViewer.jsx # 文件预览组件（弹出层）
│   │   ├── Toast.jsx      # Toast提示组件
│   │   └── icons/         # SVG图标组件
│   ├── utils/             # 工具函数
│   ├── styles/            # 样式文件
│   ├── file-manifest.json # 文件版本清单（自动生成）
│   └── App.jsx            # 主应用组件
├── generate-file-list.js  # 文件列表生成脚本（支持递归扫描）
└── vite.config.js         # Vite配置
```

## 使用说明

### 列表视图和网格视图
1. 使用搜索框搜索文件
2. 点击文件夹名称或箭头图标展开/折叠文件夹
3. **单击文件**可选中，点击下载图标下载单个文件
4. **双击文件**或点击预览图标打开预览弹窗查看内容
5. 文本文件预览时，点击右上角复制按钮可复制内容到剪贴板
6. 选中多个文件后，点击"批量下载"按钮下载所有选中文件

### 分栏视图
1. 左侧显示文件列表（支持文件夹展开/折叠）
2. 点击文件夹展开/折叠子文件
3. 点击文件名，右侧自动显示文件内容
4. 支持文本、图片、PDF预览
5. 文本文件可以一键复制内容
6. 点击下载按钮下载当前文件

## 特色功能

### 文件夹支持
- **递归扫描**：自动扫描所有子文件夹
- **展开/折叠**：点击文件夹或箭头图标控制展开状态
- **层级缩进**：子文件夹和文件根据层级自动缩进
- **视觉反馈**：文件夹使用粗体显示，箭头指示展开状态

### 三种视图模式
- **列表视图**：详细信息展示，支持批量操作，支持文件夹
- **网格视图**：卡片式展示，适合浏览
- **分栏视图**：类似GitHub，左侧列表右侧预览，支持文件夹

### 文件预览
- **PDF文件**：使用浏览器内置PDF查看器，支持缩放、翻页
- **文本文件**：使用代码编辑器风格显示，支持一键复制
- **图片文件**：居中显示，自适应大小
- **不支持预览**：显示提示信息，引导用户下载

### 复制功能
- 文本文件预览时，右上角显示复制按钮
- 点击复制按钮，内容自动复制到剪贴板
- 复制成功后图标变为绿色对勾，2秒后恢复

### Toast提示
- 下载成功：绿色边框，白色半透明背景
- 下载失败：红色边框，白色半透明背景
- 加载中：蓝色边框，白色半透明背景
- 自动2秒后消失

## 缓存控制与版本管理

### GitHub Pages缓存问题

GitHub Pages会缓存静态文件，导致更新文件后用户看不到最新内容。本系统采用**智能版本控制**解决这个问题：

### 工作原理

1. **生成文件列表时**：
   - 递归扫描 `public/files` 目录及所有子文件夹
   - 生成包含文件夹结构的 `files.json` 文件
   - 计算文件列表的MD5哈希值作为版本号
   - 将版本号保存到 `src/file-manifest.json`

2. **应用加载时**：
   - 读取 `file-manifest.json` 获取版本号
   - 请求 `files.json?v=版本号`
   - 版本号变化时，浏览器会获取新文件
   - 版本号不变时，使用缓存

### 更新流程

1. 在 `public/files` 添加、删除文件或文件夹
2. 运行 `npm run build`（自动生成新版本号）
3. 部署到GitHub Pages
4. 用户刷新页面，自动获取最新文件列表（无需清除缓存）

## 部署到GitHub Pages

### 方法一：使用gh-pages包（推荐）

```bash
npm run deploy
```

这会自动构建并部署到GitHub Pages。

### 方法二：手动部署

1. 构建项目：
```bash
npm run build
```

2. 将 `dist` 目录推送到 `gh-pages` 分支

3. 在GitHub仓库设置中启用GitHub Pages，选择 `gh-pages` 分支

### 配置base路径

如果你的仓库名不是 `username.github.io`，需要在 `vite.config.js` 中设置base：

```javascript
export default defineConfig({
  plugins: [react()],
  base: '/your-repo-name/'  // 替换为你的仓库名
})
```

## 移动端适配

- 小屏幕下自动调整布局
- 分栏视图在移动端变为上下布局
- 预览弹窗全屏显示
- 按钮和文字大小自动调整
- 隐藏部分不必要的列信息
- 文件夹展开/折叠功能在移动端同样可用

## 常见问题

### Q: 更新文件后看不到新内容？
A: 
1. 确保重新运行了 `npm run build` 并重新部署
2. 系统会自动生成新版本号，刷新页面即可看到更新
3. 如果还是看不到，尝试强制刷新（Ctrl+F5 或 Cmd+Shift+R）

### Q: 为什么有些文件预览不了？
A: 系统只支持文本、图片和PDF预览。其他格式（如Word、Excel原格式）需要下载后查看。

### Q: 如何切换视图模式？
A: 点击工具栏右侧的视图切换按钮：
- 列表图标：列表视图
- 网格图标：网格视图
- 分栏图标：分栏视图（类似GitHub）

### Q: 文件夹如何展开/折叠？
A: 
- **列表视图**：点击文件夹名称或左侧箭头图标
- **分栏视图**：点击文件夹名称或左侧箭头图标
- **网格视图**：暂不支持文件夹展开（显示所有文件）

### Q: 支持多少层文件夹嵌套？
A: 理论上支持无限层嵌套，但建议不超过5层以保持良好的用户体验。

### Q: 文件夹可以下载吗？
A: 当前版本不支持文件夹下载，只能下载单个文件或批量下载选中的文件。

## 技术细节

### 文件列表生成

`generate-file-list.js` 脚本会：
1. 递归扫描 `public/files` 目录及所有子文件夹
2. 收集文件和文件夹信息（名称、路径、大小、修改时间）
3. 构建文件树结构
4. 扁平化为列表并添加ID和父路径信息
5. 生成 `public/api/files.json`
6. 计算内容哈希生成版本号
7. 保存版本信息到 `src/file-manifest.json`

### 文件路径结构

```json
{
  "id": 1,
  "name": "文档",
  "path": "文档",
  "type": "folder",
  "parentPath": "",
  "hasChildren": true
},
{
  "id": 2,
  "name": "说明.md",
  "path": "文档/说明.md",
  "type": "file",
  "parentPath": "文档"
}
```

### 展开/折叠逻辑

- 使用 `expandedFolders` 数组存储已展开的文件夹路径
- 根据 `parentPath` 判断文件是否应该显示
- 只有父文件夹展开时，子文件才可见

## 注意事项

- 纯前端实现，无需后端服务器
- 文件直接从 `public/files` 目录读取
- 支持任意层级的文件夹嵌套
- 每次添加、删除文件或文件夹后，需要重新运行 `npm run build`
- 大文件预览可能需要较长加载时间
- 建议文件大小不超过10MB以获得最佳体验
- 批量下载会依次触发多个下载，浏览器可能会提示是否允许多个下载
- 文件名和文件夹名支持中文和特殊字符
- 版本控制确保文件列表实时更新，无需手动清除浏览器缓存

## License

MIT
