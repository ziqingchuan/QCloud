# 文件管理系统 (QCloud)

一个类似百度云盘的文件管理系统，支持文件展示、预览、搜索、下载等功能。纯前端实现，无需后端。

## 功能特性

- 自动读取 `public/files` 文件夹中的所有文件
- **三种视图模式**：列表视图、网格视图、分栏视图（类似GitHub）
- 文件搜索功能
- 双击文件预览内容（弹出层显示）
- 支持文本文件预览（TXT、MD、HTML、CSS、JS、JSON、CSV等）
- 支持图片文件预览（JPG、PNG、GIF、SVG、WEBP等）
- 支持PDF文件预览（浏览器内置查看器）
- 文本文件一键复制到剪贴板
- 单个文件下载
- 批量文件下载
- 响应式设计，支持移动端
- 专业的B端后台风格界面
- 优雅的顶部Toast提示
- 支持多种文件类型识别
- 智能版本控制，确保文件列表实时更新

## 技术栈

- React 19
- Vite
- CSS3

## 视图模式

### 1. 列表视图（默认）
- 显示详细信息：名称、大小、修改日期、操作
- 支持文件选择和批量下载
- 适合管理大量文件

### 2. 网格视图
- 卡片式展示
- 大图标显示
- 适合浏览图片和文档

### 3. 分栏视图（类似GitHub）
- 左侧：文件列表
- 右侧：文件预览
- 点击文件即可在右侧查看内容
- 适合快速浏览和查看文件内容
- 支持文本、图片、PDF预览
- 支持一键复制文本内容

## 开始使用

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

系统会自动扫描 `public/files` 目录并生成文件列表，然后启动开发服务器。

访问 http://localhost:5173

### 构建生产版本

```bash
npm run build
```

构建前会自动生成文件列表，打包后的文件在 `dist` 目录。

## 文件管理

将需要展示的文件放置在 `public/files` 目录下，系统会自动读取并展示。

### 支持预览的文件类型

**PDF文件：**
- PDF（浏览器内置查看器）

**文本文件：**
- TXT, MD, HTML, CSS, JS, JSX, TS, TSX
- JSON, XML, CSV, LOG
- DOC, DOCX（作为文本预览）

**图片文件：**
- JPG, JPEG, PNG, GIF, SVG, WEBP, BMP

**其他文件：**
- ZIP, RAR, 7Z等压缩包
- 不支持预览，但可以下载

## 项目结构

```
├── public/
│   ├── files/              # 存放文件的目录
│   └── api/                # 自动生成的文件列表
│       └── files.json      # 文件元数据
├── src/
│   ├── components/         # 组件目录
│   │   ├── FileList.jsx   # 文件列表组件
│   │   ├── FileItem.jsx   # 文件项组件
│   │   ├── SplitView.jsx  # 分栏视图组件
│   │   ├── Toolbar.jsx    # 工具栏组件
│   │   ├── FileViewer.jsx # 文件预览组件（弹出层）
│   │   ├── Toast.jsx      # Toast提示组件
│   │   └── icons/         # SVG图标组件
│   ├── utils/             # 工具函数
│   ├── styles/            # 样式文件
│   ├── file-manifest.json # 文件版本清单（自动生成）
│   └── App.jsx            # 主应用组件
├── generate-file-list.js  # 文件列表生成脚本
└── vite.config.js         # Vite配置
```

## 使用说明

### 列表视图和网格视图
1. 使用搜索框搜索文件
2. **单击文件**可选中，点击下载图标下载单个文件
3. **双击文件**或点击预览图标打开预览弹窗查看内容
4. 文本文件预览时，点击右上角复制按钮可复制内容到剪贴板
5. 选中多个文件后，点击"批量下载"按钮下载所有选中文件

### 分栏视图
1. 左侧显示文件列表
2. 点击文件名，右侧自动显示文件内容
3. 支持文本、图片、PDF预览
4. 文本文件可以一键复制内容
5. 点击下载按钮下载当前文件

## 特色功能

### 三种视图模式
- **列表视图**：详细信息展示，支持批量操作
- **网格视图**：卡片式展示，适合浏览
- **分栏视图**：类似GitHub，左侧列表右侧预览，快速查看文件内容

### 文件预览
- **PDF文件**：使用浏览器内置PDF查看器，支持缩放、翻页
- **文本文件**：使用代码编辑器风格显示，支持一键复制
- **图片文件**：居中显示，自适应大小
- **不支持预览**：显示提示信息，引导用户下载

### 复制功能
- 文本文件预览时，右上角显示复制按钮
- 点击复制按钮，内容自动复制到剪贴板
- 复制成功后图标变为绿色对勾，2秒后恢复

### Toast提示
- 下载成功：绿色边框，白色半透明背景
- 下载失败：红色边框，白色半透明背景
- 加载中：蓝色边框，白色半透明背景
- 自动2秒后消失

### 文件选择（列表/网格视图）
- 单击选中文件，显示蓝色边框和对勾
- 双击打开预览
- 背景保持透明，不会变色

## 缓存控制与版本管理

### GitHub Pages缓存问题

GitHub Pages会缓存静态文件，导致更新文件后用户看不到最新内容。本系统采用**智能版本控制**解决这个问题：

### 工作原理

1. **生成文件列表时**：
   - 扫描 `public/files` 目录
   - 生成 `files.json` 文件
   - 计算文件列表的MD5哈希值作为版本号
   - 将版本号保存到 `src/file-manifest.json`

2. **应用加载时**：
   - 读取 `file-manifest.json` 获取版本号
   - 请求 `files.json?v=版本号`
   - 版本号变化时，浏览器会获取新文件
   - 版本号不变时，使用缓存

### 更新流程

1. 在 `public/files` 添加或删除文件
2. 运行 `npm run build`（自动生成新版本号）
3. 部署到GitHub Pages
4. 用户刷新页面，自动获取最新文件列表（无需清除缓存）

## 部署到GitHub Pages

### 方法一：使用gh-pages包（推荐）

```bash
npm run deploy
```

这会自动构建并部署到GitHub Pages。

### 方法二：手动部署

1. 构建项目：
```bash
npm run build
```

2. 将 `dist` 目录推送到 `gh-pages` 分支

3. 在GitHub仓库设置中启用GitHub Pages，选择 `gh-pages` 分支

### 配置base路径

如果你的仓库名不是 `username.github.io`，需要在 `vite.config.js` 中设置base：

```javascript
export default defineConfig({
  plugins: [react()],
  base: '/your-repo-name/'  // 替换为你的仓库名
})
```

## 移动端适配

- 小屏幕下自动调整布局
- 分栏视图在移动端变为上下布局
- 预览弹窗全屏显示
- 按钮和文字大小自动调整
- 隐藏部分不必要的列信息

## 常见问题

### Q: 更新文件后看不到新内容？
A: 
1. 确保重新运行了 `npm run build` 并重新部署
2. 系统会自动生成新版本号，刷新页面即可看到更新
3. 如果还是看不到，尝试强制刷新（Ctrl+F5 或 Cmd+Shift+R）

### Q: 为什么有些文件预览不了？
A: 系统只支持文本、图片和PDF预览。其他格式（如Word、Excel原格式）需要下载后查看。

### Q: 如何切换视图模式？
A: 点击工具栏右侧的视图切换按钮：
- 列表图标：列表视图
- 网格图标：网格视图
- 分栏图标：分栏视图（类似GitHub）

### Q: 分栏视图和弹窗预览有什么区别？
A: 
- **分栏视图**：左右分栏，点击文件即可在右侧查看，适合快速浏览多个文件
- **弹窗预览**：双击文件打开全屏弹窗，适合专注查看单个文件

### Q: 支持文件夹吗？
A: 当前版本只支持 `public/files` 根目录下的文件，不支持子文件夹。

## 技术细节

### 文件列表生成

`generate-file-list.js` 脚本会：
1. 扫描 `public/files` 目录
2. 收集文件信息（名称、大小、修改时间）
3. 生成 `public/api/files.json`
4. 计算内容哈希生成版本号
5. 保存版本信息到 `src/file-manifest.json`

### 版本控制流程

```
文件变化 -> 重新构建 -> 生成新版本号 -> 
打包到dist -> 部署 -> 用户访问 -> 
检测到新版本 -> 获取最新数据
```

## 注意事项

- 纯前端实现，无需后端服务器
- 文件直接从 `public/files` 目录读取
- 每次添加或删除文件后，需要重新运行 `npm run build`
- 大文件预览可能需要较长加载时间
- 建议文件大小不超过10MB以获得最佳体验
- 批量下载会依次触发多个下载，浏览器可能会提示是否允许多个下载
- 文件名支持中文和特殊字符
- 版本控制确保文件列表实时更新，无需手动清除浏览器缓存

## License

MIT
